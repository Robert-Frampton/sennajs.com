<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: senna.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: senna.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code><span class="hljs-string">'use strict'</span>;

(function(window, undefined) {
  window.senna = window.senna || {};

  <span class="hljs-javadoc">/**
   * Appends a node with text or other nodes.
   * <span class="hljs-javadoctag">@param</span> {!Node} parent The node to append nodes to.
   * <span class="hljs-javadoctag">@param</span> {!Node|String} child The thing to append to the parent.
   */</span>
  senna.append = function(parent, child) {
    <span class="hljs-keyword">if</span> (senna.isString(child)) {
      child = senna.buildFragment(child);
    }
    <span class="hljs-keyword">return</span> parent.appendChild(senna.parseScripts(child));
  };

  <span class="hljs-javadoc">/**
   * Creates a new function that, when called, has its this keyword set to the
   * provided value, with a given sequence of arguments preceding any provided
   * when the new function is called.
   *
   * Usage: &lt;pre&gt;var fn = bind(myFunction, myObj, 'arg1', 'arg2');
   * fn('arg3', 'arg4');&lt;/pre&gt;
   *
   * <span class="hljs-javadoctag">@param</span> {function} fn A function to partially apply.
   * <span class="hljs-javadoctag">@param</span> {!Object} context Specifies the object which this should point to
   *     when the function is run.
   * <span class="hljs-javadoctag">@param</span> {...*} var_args Additional arguments that are partially applied to
   *     the function.
   * <span class="hljs-javadoctag">@return</span> {!Function} A partially-applied form of the function bind() was
   *     invoked as a method of.
   */</span>
  senna.bind = function(fn, context) {
    <span class="hljs-keyword">if</span> (!fn) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error();
    }

    <span class="hljs-keyword">if</span> (Function.prototype.bind) {
      <span class="hljs-keyword">var</span> bind = fn.call.apply(fn.bind, arguments);
      <span class="hljs-keyword">return</span> function() {
        <span class="hljs-keyword">return</span> bind.apply(<span class="hljs-keyword">null</span>, arguments);
      };
    }

    <span class="hljs-keyword">if</span> (arguments.length &gt; <span class="hljs-number">2</span>) {
      <span class="hljs-keyword">var</span> args = Array.prototype.slice.call(arguments, <span class="hljs-number">2</span>);
      <span class="hljs-keyword">return</span> function() {
        <span class="hljs-keyword">var</span> newArgs = Array.prototype.slice.call(arguments);
        Array.prototype.unshift.apply(newArgs, args);
        <span class="hljs-keyword">return</span> fn.apply(context, newArgs);
      };
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> function() {
        <span class="hljs-keyword">return</span> fn.apply(context, arguments);
      };
    }
  };

  <span class="hljs-javadoc">/**
   * Helper for &lt;code&gt;buildFragment&lt;/code&gt;.
   * <span class="hljs-javadoctag">@param</span> {!Document} doc The document.
   * <span class="hljs-javadoctag">@param</span> {string} htmlString The HTML string to convert.
   * <span class="hljs-javadoctag">@return</span> {!Node} The resulting document fragment.
   * <span class="hljs-javadoctag">@private</span>
   */</span>
  senna.buildFragment = function(htmlString) {
    <span class="hljs-keyword">var</span> tempDiv = document.createElement(<span class="hljs-string">'div'</span>);
    tempDiv.innerHTML = <span class="hljs-string">'&lt;br&gt;'</span> + htmlString;
    tempDiv.removeChild(tempDiv.firstChild);

    <span class="hljs-keyword">var</span> fragment = document.createDocumentFragment();
    <span class="hljs-keyword">while</span> (tempDiv.firstChild) {
      fragment.appendChild(tempDiv.firstChild);
    }
    <span class="hljs-keyword">return</span> fragment;
  };

  <span class="hljs-javadoc">/**
   * Debounces function execution.
   * <span class="hljs-javadoctag">@param</span> {Function} fn
   * <span class="hljs-javadoctag">@param</span> {Number} delay
   * <span class="hljs-javadoctag">@return</span> {Function}
   */</span>
  senna.debounce = function(fn, delay, opt_context) {
    <span class="hljs-keyword">var</span> id;
    <span class="hljs-keyword">return</span> function() {
      <span class="hljs-keyword">if</span> (!opt_context) {
        opt_context = <span class="hljs-keyword">this</span>;
      }
      <span class="hljs-keyword">var</span> args = arguments;
      clearTimeout(id);
      id = setTimeout(function() {
        fn.apply(opt_context, args);
      }, delay);
    };
  };

  <span class="hljs-javadoc">/**
   * Returns an object based on its fully qualified external name.
   * <span class="hljs-javadoctag">@param</span> {String} name The fully qualified name.
   * <span class="hljs-javadoctag">@param</span> {Object=} opt_obj The object within which to look; default is
   *     &lt;code&gt;window&lt;/code&gt;.
   * <span class="hljs-javadoctag">@return</span> {?} The value (object or primitive) or, if not found, null.
   */</span>
  senna.getObjectByName = function(name, opt_obj) {
    <span class="hljs-keyword">var</span> parts = name.split(<span class="hljs-string">'.'</span>);
    <span class="hljs-keyword">var</span> cur = opt_obj || window;
    <span class="hljs-keyword">var</span> part;
    <span class="hljs-keyword">while</span> ((part = parts.shift())) {
      <span class="hljs-keyword">if</span> (senna.isDefAndNotNull(cur[part])) {
        cur = cur[part];
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
      }
    }
    <span class="hljs-keyword">return</span> cur;
  };

  <span class="hljs-javadoc">/**
   * Evaluates script globally.
   * <span class="hljs-javadoctag">@param</span> {String} data
   */</span>
  senna.globalEval = function(data) {
    <span class="hljs-comment">/* jshint evil: true */</span>
    <span class="hljs-keyword">if</span> (data &amp;&amp; data.trim()) {
      <span class="hljs-keyword">var</span> evaluator = window.execScript;
      <span class="hljs-keyword">if</span> (!evaluator) {
        evaluator = function(data) {
          window[<span class="hljs-string">'eval'</span>].call(window, data);
        };
      }
      evaluator(data);
    }
  };

  <span class="hljs-javadoc">/**
   * Inherits the prototype methods from one constructor into another.
   *
   * Usage:
   * &lt;pre&gt;
   * function ParentClass(a, b) { }
   * ParentClass.prototype.foo = function(a) { }
   *
   * function ChildClass(a, b, c) {
   *   tracking.base(this, a, b);
   * }
   * tracking.inherits(ChildClass, ParentClass);
   *
   * var child = new ChildClass('a', 'b', 'c');
   * child.foo();
   * &lt;/pre&gt;
   *
   * <span class="hljs-javadoctag">@param</span> {Function} childCtor Child class.
   * <span class="hljs-javadoctag">@param</span> {Function} parentCtor Parent class.
   */</span>
  senna.inherits = function(childCtor, parentCtor) {
    function TempCtor() {
    }
    TempCtor.prototype = parentCtor.prototype;
    childCtor.superClass_ = parentCtor.prototype;
    childCtor.prototype = <span class="hljs-keyword">new</span> TempCtor();
    childCtor.prototype.constructor = childCtor;

    <span class="hljs-javadoc">/**
     * Calls superclass constructor/method.
     *
     * This function is only available if you use tracking.inherits to express
     * inheritance relationships between classes.
     *
     * <span class="hljs-javadoctag">@param</span> {!object} me Should always be "this".
     * <span class="hljs-javadoctag">@param</span> {string} methodName The method name to call. Calling superclass
     *     constructor can be done with the special string 'constructor'.
     * <span class="hljs-javadoctag">@param</span> {...*} var_args The arguments to pass to superclass
     *     method/constructor.
     * <span class="hljs-javadoctag">@return</span> {*} The return value of the superclass method/constructor.
     */</span>
    childCtor.base = function(me, methodName) {
      <span class="hljs-keyword">var</span> args = Array.prototype.slice.call(arguments, <span class="hljs-number">2</span>);
      <span class="hljs-keyword">return</span> parentCtor.prototype[methodName].apply(me, args);
    };
  };

  <span class="hljs-javadoc">/**
   * Returns true if the specified value is not undefined.
   * <span class="hljs-javadoctag">@param</span> {?} val Variable to test.
   * <span class="hljs-javadoctag">@return</span> {boolean} Whether variable is defined.
   */</span>
  senna.isDef = function(<span class="hljs-keyword">val</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">val</span> !== undefined;
  };

  <span class="hljs-javadoc">/**
   * Returns true if value is not undefined or null.
   * <span class="hljs-javadoctag">@param</span> {*} val
   * <span class="hljs-javadoctag">@return</span> {Boolean}
   */</span>
  senna.isDefAndNotNull = function(<span class="hljs-keyword">val</span>) {
    <span class="hljs-keyword">return</span> senna.isDef(<span class="hljs-keyword">val</span>) &amp;&amp; !senna.isNull(<span class="hljs-keyword">val</span>);
  };

  <span class="hljs-javadoc">/**
   * Returns true if value is a dom element.
   * <span class="hljs-javadoctag">@param</span> {*} val
   * <span class="hljs-javadoctag">@return</span> {Boolean}
   */</span>
  senna.isElement = function(<span class="hljs-keyword">val</span>) {
    <span class="hljs-keyword">return</span> typeof <span class="hljs-keyword">val</span> === <span class="hljs-string">'object'</span> &amp;&amp; <span class="hljs-keyword">val</span>.nodeType === <span class="hljs-number">1</span>;
  };

  <span class="hljs-javadoc">/**
   * Returns true if the specified value is a function.
   * <span class="hljs-javadoctag">@param</span> {?} val Variable to test.
   * <span class="hljs-javadoctag">@return</span> {boolean} Whether variable is a function.
   */</span>
  senna.isFunction = function(<span class="hljs-keyword">val</span>) {
    <span class="hljs-keyword">return</span> typeof (<span class="hljs-keyword">val</span>) === <span class="hljs-string">'function'</span>;
  };

  <span class="hljs-javadoc">/**
   * Returns true if value is null.
   * <span class="hljs-javadoctag">@param</span> {*} val
   * <span class="hljs-javadoctag">@return</span> {Boolean}
   */</span>
  senna.isNull = function(<span class="hljs-keyword">val</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">val</span> === <span class="hljs-keyword">null</span>;
  };

  <span class="hljs-javadoc">/**
   * Returns true if the specified value is an object. This includes arrays
   * and functions.
   * <span class="hljs-javadoctag">@param</span> {?} val Variable to test.
   * <span class="hljs-javadoctag">@return</span> {boolean} Whether variable is an object.
   */</span>
  senna.isObject = function(<span class="hljs-keyword">val</span>) {
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">type</span> = typeof <span class="hljs-keyword">val</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">type</span> === <span class="hljs-string">'object'</span> &amp;&amp; <span class="hljs-keyword">val</span> !== <span class="hljs-keyword">null</span> || <span class="hljs-keyword">type</span> === <span class="hljs-string">'function'</span>;
  };

  <span class="hljs-javadoc">/**
   * Returns true if value is a string.
   * <span class="hljs-javadoctag">@param</span> {*} val
   * <span class="hljs-javadoctag">@return</span> {Boolean}
   */</span>
  senna.isString = function(<span class="hljs-keyword">val</span>) {
    <span class="hljs-keyword">return</span> typeof <span class="hljs-keyword">val</span> === <span class="hljs-string">'string'</span>;
  };

  <span class="hljs-javadoc">/**
   * Check if an element matches a given selector.
   * <span class="hljs-javadoctag">@param</span> {Event} element
   * <span class="hljs-javadoctag">@param</span> {String} selector
   * <span class="hljs-javadoctag">@return</span> {Boolean}
   */</span>
  senna.<span class="hljs-keyword">match</span> = function(element, selector) {
    <span class="hljs-keyword">if</span> (!element || element.nodeType !== <span class="hljs-number">1</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    }

    <span class="hljs-keyword">var</span> p = Element.prototype;
    <span class="hljs-keyword">var</span> m = p.matches || p.webkitMatchesSelector || p.mozMatchesSelector || p.msMatchesSelector || p.oMatchesSelector;
    <span class="hljs-keyword">if</span> (m) {
      <span class="hljs-keyword">return</span> m.call(element, selector);
    }

    <span class="hljs-keyword">var</span> nodes = document.querySelectorAll(selector, element.parentNode);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; nodes.length; ++i) {
      <span class="hljs-keyword">if</span> (nodes[i] === element) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
  };

  <span class="hljs-javadoc">/**
   * Parses script nodes inside a fragment and sterilizes them setting their types to text/parsed.
   * <span class="hljs-javadoctag">@param</span> {!Element} frag
   * <span class="hljs-javadoctag">@return</span> {Element}
   */</span>
  senna.parseScripts = function(frag) {
    <span class="hljs-keyword">var</span> globalEval = function(o) {
      senna.globalEval(o.responseText || o.text || o.textContent || o.innerHTML || <span class="hljs-string">''</span>);
    };
    <span class="hljs-keyword">var</span> scripts = Array.prototype.slice.call(frag.querySelectorAll(<span class="hljs-string">'script'</span>));
    <span class="hljs-keyword">while</span> (scripts.length) {
      <span class="hljs-keyword">var</span> script = scripts.shift();

      <span class="hljs-comment">// Some browsers evaluates scripts when appended to document. Sterilizes</span>
      <span class="hljs-comment">// evaluated scripts setting type to text/parsed.</span>
      script.setAttribute(<span class="hljs-string">'type'</span>, <span class="hljs-string">'text/parsed'</span>);

      <span class="hljs-keyword">if</span> (script.src) {
        <span class="hljs-keyword">var</span> headers = {
          <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/javascript'</span>
        };
        senna.request(script.src, <span class="hljs-string">'GET'</span>, headers, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">true</span>).then(globalEval);
      } <span class="hljs-keyword">else</span> {
        senna.async.nextTick(senna.bind(globalEval, <span class="hljs-keyword">null</span>, script));
      }
    }
    <span class="hljs-keyword">return</span> frag;
  };

  <span class="hljs-javadoc">/**
   * Removes element from the dom.
   * <span class="hljs-javadoctag">@param</span> {Element} element
   */</span>
  senna.remove = function(element) {
    <span class="hljs-keyword">if</span> (element.parentNode) {
      element.parentNode.removeChild(element);
    }
  };

  <span class="hljs-javadoc">/**
   * Requests the url using XMLHttpRequest.
   * <span class="hljs-javadoctag">@param</span> {!String} url
   * <span class="hljs-javadoctag">@param</span> {!String} httpMethod
   * <span class="hljs-javadoctag">@param</span> {Object=} opt_httpHeaders
   * <span class="hljs-javadoctag">@param</span> {Number=} opt_timeout
   * <span class="hljs-javadoctag">@param</span> {Boolean=} opt_sync
   * <span class="hljs-javadoctag">@return</span> {Promise} Promisified ajax request.
   */</span>
  senna.request = function(url, httpMethod, opt_httpHeaders, opt_timeout, opt_sync) {
    <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();

    <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">new</span> senna.Promise(function(resolve, reject) {
      xhr.onload = function() {
        <span class="hljs-keyword">if</span> (xhr.status === <span class="hljs-number">200</span>) {
          resolve(xhr);
          <span class="hljs-keyword">return</span>;
        }
        xhr.onerror();
      };
      xhr.onerror = function() {
        <span class="hljs-keyword">var</span> error = <span class="hljs-keyword">new</span> Error(<span class="hljs-string">'Request error'</span>);
        error.xhr = xhr;
        reject(error);
      };
    }).thenCatch(function(reason) {
      xhr.abort();
      <span class="hljs-keyword">throw</span> reason;
    }).thenAlways(function() {
      clearTimeout(timeout);
    });

    xhr.open(httpMethod, url, !opt_sync);
    <span class="hljs-keyword">if</span> (opt_httpHeaders) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i in opt_httpHeaders) {
        xhr.setRequestHeader(i, opt_httpHeaders[i]);
      }
    }
    xhr.send(<span class="hljs-keyword">null</span>);

    <span class="hljs-keyword">if</span> (senna.isDef(opt_timeout)) {
      <span class="hljs-keyword">var</span> timeout = setTimeout(function() {
        promise.cancel(<span class="hljs-string">'Request timeout'</span>);
      }, opt_timeout);
    }

    <span class="hljs-keyword">return</span> promise;
  };

  <span class="hljs-javadoc">/**
   * Browser features
   */</span>
  senna.BrowserFeatures = {};
  senna.BrowserFeatures.chrome = navigator.userAgent.indexOf(<span class="hljs-string">'Chrome'</span>) &gt; -<span class="hljs-number">1</span>;
  senna.BrowserFeatures.safari = navigator.userAgent.indexOf(<span class="hljs-string">'Safari'</span>) &gt; -<span class="hljs-number">1</span> &amp;&amp; !senna.BrowserFeatures.chrome;

  document.addEventListener(<span class="hljs-string">'DOMContentLoaded'</span>, function() {
    <span class="hljs-javadoc">/**
     * Data attribute handler.
     * <span class="hljs-javadoctag">@type</span> {senna.DataAttributeHandler}
     * <span class="hljs-javadoctag">@default</span> new senna.DataAttributeHandler(document.body)
     */</span>
    senna.dataAttributeHandler = <span class="hljs-keyword">new</span> senna.DataAttributeHandler(document.body);
  });
}(window));
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="senna.App.html">App</a></li><li><a href="senna.Cacheable.html">Cacheable</a></li><li><a href="senna.DataAttributeHandler.html">DataAttributeHandler</a></li><li><a href="senna.EventEmitter.html">EventEmitter</a></li><li><a href="senna.HtmlScreen.html">HtmlScreen</a></li><li><a href="senna.RequestScreen.html">RequestScreen</a></li><li><a href="senna.Route.html">Route</a></li><li><a href="senna.Screen.html">Screen</a></li><li><a href="senna.Surface.html">Surface</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Tue Aug 26 2014 09:02:40 GMT-0300 (BRT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
