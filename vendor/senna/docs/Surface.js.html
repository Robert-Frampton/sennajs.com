<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: surface/Surface.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: surface/Surface.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>(function() {
  <span class="hljs-string">'use strict'</span>;

  <span class="hljs-javadoc">/**
   * Surface class representing the references to elements on the page that
   * can potentially be updated by &lt;code&gt;senna.App&lt;/code&gt;.
   * <span class="hljs-javadoctag">@param</span> {String} id
   * <span class="hljs-javadoctag">@constructor</span>
   */</span>
  senna.Surface = function(id) {
    <span class="hljs-keyword">if</span> (!id) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">'Surface element id not specified.'</span>);
    }
    <span class="hljs-keyword">this</span>.setId(id);
  };

  <span class="hljs-javadoc">/**
   * Holds the default surface name. Elements on the page must contain a child
   * element containing the default content, this element must be as following:
   *
   * Example:
   * &lt;code&gt;
   *   &lt;div id="mysurface"&gt;
   *     &lt;div id="mysurface-default"&gt;Default surface content.&lt;/div&gt;
   *   &lt;/div&gt;
   * &lt;/code&gt;
   *
   * The default content is relevant for the initial page content. When a
   * screen doesn't provide content for the surface the default content is
   * restored into the page.
   *
   * <span class="hljs-javadoctag">@type</span> {!String}
   * <span class="hljs-javadoctag">@default</span> default
   * <span class="hljs-javadoctag">@static</span>
   */</span>
  senna.Surface.DEFAULT = <span class="hljs-string">'default'</span>;

  <span class="hljs-javadoc">/**
   * Holds the default transition for all surfaces. Each surface could have its
   * own transition.
   *
   * Example:
   *
   * &lt;code&gt;
   * surface.setTransitionFn(function(from, to) {
   *   if (from) {
   *     from.style.display = 'none';
   *     from.classList.remove('flipped');
   *   }
   *   if (to) {
   *     to.style.display = 'block';
   *     to.classList.add('flipped');
   *   }
   *   return null;
   * });
   * &lt;/code&gt;
   *
   * <span class="hljs-javadoctag">@param</span> {?Element=} from The visible surface element.
   * <span class="hljs-javadoctag">@param</span> {?Element=} to The surface element to be flipped.
   * <span class="hljs-javadoctag">@static</span>
   */</span>
  senna.Surface.TRANSITION = function(from, to) {
    <span class="hljs-keyword">if</span> (from) {
      from.style.display = <span class="hljs-string">'none'</span>;
      from.classList.remove(<span class="hljs-string">'flipped'</span>);
    }
    <span class="hljs-keyword">if</span> (to) {
      to.style.display = <span class="hljs-string">'block'</span>;
      to.classList.add(<span class="hljs-string">'flipped'</span>);
    }
  };
  <span class="hljs-javadoc">/**
   * Holds the active child element.
   * <span class="hljs-javadoctag">@type</span> {Element}
   * <span class="hljs-javadoctag">@default</span> null
   * <span class="hljs-javadoctag">@protected</span>
   */</span>
  senna.Surface.prototype.activeChild = <span class="hljs-keyword">null</span>;

  <span class="hljs-javadoc">/**
   * Holds the default child element.
   * <span class="hljs-javadoctag">@type</span> {Element}
   * <span class="hljs-javadoctag">@default</span> null
   * <span class="hljs-javadoctag">@protected</span>
   */</span>
  senna.Surface.prototype.defaultChild = <span class="hljs-keyword">null</span>;

  <span class="hljs-javadoc">/**
   * Holds the element with the specified surface id, if not found creates a
   * new element with the specified id.
   * <span class="hljs-javadoctag">@type</span> {Element}
   * <span class="hljs-javadoctag">@default</span> null
   * <span class="hljs-javadoctag">@protected</span>
   */</span>
  senna.Surface.prototype.el = <span class="hljs-keyword">null</span>;

  <span class="hljs-javadoc">/**
   * Holds the surface id.
   * <span class="hljs-javadoctag">@type</span> {String}
   * <span class="hljs-javadoctag">@default</span> null
   * <span class="hljs-javadoctag">@protected</span>
   */</span>
  senna.Surface.prototype.id = <span class="hljs-keyword">null</span>;

  <span class="hljs-javadoc">/**
   * Holds the default transitionFn for the surfaces.
   * <span class="hljs-javadoctag">@param</span> {?Element=} from The visible surface element.
   * <span class="hljs-javadoctag">@param</span> {?Element=} to The surface element to be flipped.
   * <span class="hljs-javadoctag">@default</span> senna.Surface.TRANSITION
   */</span>
  senna.Surface.prototype.transitionFn = <span class="hljs-keyword">null</span>;

  <span class="hljs-javadoc">/**
   * Adds screen content to a surface. If content hasn't been passed, see if
   * an element exists in the DOM that matches the id. By convention, the
   * element should already be nested in the right element and should have an
   * id that is a concatentation of the surface id + '-' + the screen id.
   * <span class="hljs-javadoctag">@param</span> {!String} screenId The screen id the content belongs too.
   * <span class="hljs-javadoctag">@param</span> {?String|Element=} opt_content The string content or element to add
   *     be added as surface content.
   * <span class="hljs-javadoctag">@return</span> {Element}
   */</span>
  senna.Surface.prototype.addContent = function(screenId, opt_content) {
    <span class="hljs-keyword">if</span> (!opt_content) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getChild(screenId);
    }

    console.log(<span class="hljs-string">'Screen ['</span> + screenId + <span class="hljs-string">'] add content to surface ['</span> + <span class="hljs-keyword">this</span> + <span class="hljs-string">']'</span>);

    <span class="hljs-keyword">var</span> el = <span class="hljs-keyword">this</span>.getEl();
    <span class="hljs-keyword">var</span> child = <span class="hljs-keyword">this</span>.createChild(screenId);

    senna.append(child, opt_content);

    <span class="hljs-keyword">this</span>.transition(child, <span class="hljs-keyword">null</span>);

    <span class="hljs-keyword">if</span> (el) {
      senna.append(el, child);
    }

    <span class="hljs-keyword">return</span> child;
  };

  <span class="hljs-javadoc">/**
   * Creates child node for the surface.
   * <span class="hljs-javadoctag">@param</span> {!String} screenId The screen id.
   * <span class="hljs-javadoctag">@return</span> {Element}
   */</span>
  senna.Surface.prototype.createChild = function(screenId) {
    <span class="hljs-keyword">var</span> child = document.createElement(<span class="hljs-string">'div'</span>);
    child.setAttribute(<span class="hljs-string">'id'</span>, <span class="hljs-keyword">this</span>.makeId_(screenId));
    <span class="hljs-keyword">return</span> child;
  };

  <span class="hljs-javadoc">/**
   * Gets the surface element from element, and sets it to the el property of
   * the current instance.
   * <span class="hljs-javadoctag">@param</span> {!String} opt_id The id of the surface element. If not provided,
   *     &lt;code&gt;this.el&lt;/code&gt; will be used.
   * <span class="hljs-javadoctag">@return</span> {?Element} The current surface element.
   */</span>
  senna.Surface.prototype.getEl = function(opt_id) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.el) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.el;
    }
    <span class="hljs-keyword">this</span>.el = document.getElementById(opt_id || <span class="hljs-keyword">this</span>.id);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.el;
  };

  <span class="hljs-javadoc">/**
   * Gets the surface id.
   * <span class="hljs-javadoctag">@return</span> {String}
   */</span>
  senna.Surface.prototype.getId = function() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.id;
  };

  <span class="hljs-javadoc">/**
   * Gets child node of the surface.
   * <span class="hljs-javadoctag">@param</span> {!String} screenId The screen id.
   * <span class="hljs-javadoctag">@return</span> {?Element}
   */</span>
  senna.Surface.prototype.getChild = function(screenId) {
    <span class="hljs-keyword">return</span> document.getElementById(<span class="hljs-keyword">this</span>.makeId_(screenId));
  };

  <span class="hljs-javadoc">/**
   * Gets the surface transition function.
   * See &lt;code&gt;senna.Surface.TRANSITION&lt;/code&gt;.
   * <span class="hljs-javadoctag">@return</span> {?Function=} The transition function.
   */</span>
  senna.Surface.prototype.getTransitionFn = function() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.transitionFn;
  };

  <span class="hljs-javadoc">/**
   * Makes the id for the element that holds content for a screen.
   * <span class="hljs-javadoctag">@param</span> {!String} screenId The screen id the content belongs too.
   * <span class="hljs-javadoctag">@return</span> {String}
   * <span class="hljs-javadoctag">@private</span>
   */</span>
  senna.Surface.prototype.makeId_ = function(screenId) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.id + <span class="hljs-string">'-'</span> + screenId;
  };

  <span class="hljs-javadoc">/**
   * Sets the surface id.
   * <span class="hljs-javadoctag">@param</span> {!String} id
   */</span>
  senna.Surface.prototype.setId = function(id) {
    <span class="hljs-keyword">this</span>.id = id;
  };

  <span class="hljs-javadoc">/**
   * Sets the surface transition function.
   * See &lt;code&gt;senna.Surface.TRANSITION&lt;/code&gt;.
   * <span class="hljs-javadoctag">@param</span> {?Function=} transitionFn The transition function.
   */</span>
  senna.Surface.prototype.setTransitionFn = function(transitionFn) {
    <span class="hljs-keyword">this</span>.transitionFn = transitionFn;
  };

  <span class="hljs-javadoc">/**
   * Shows screen content from a surface.
   * <span class="hljs-javadoctag">@param</span> {String} screenId The screen id to show.
   * <span class="hljs-javadoctag">@return</span> {?Promise=} If returns a promise pauses the navigation until it is
   *     resolved.
   */</span>
  senna.Surface.prototype.show = function(screenId) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.defaultChild) {
      <span class="hljs-keyword">this</span>.defaultChild = <span class="hljs-keyword">this</span>.addContent(senna.Surface.DEFAULT);
    }

    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.activeChild) {
      <span class="hljs-keyword">this</span>.activeChild = <span class="hljs-keyword">this</span>.defaultChild;
    }

    <span class="hljs-keyword">var</span> from = <span class="hljs-keyword">this</span>.activeChild;
    <span class="hljs-keyword">var</span> to = <span class="hljs-keyword">this</span>.getChild(screenId);

    <span class="hljs-keyword">if</span> (!to) {
      <span class="hljs-comment">// When surface child for screen not found retrieve the default</span>
      <span class="hljs-comment">// content from DOM element with id `surfaceId-default`</span>
      to = <span class="hljs-keyword">this</span>.defaultChild;
    }

    <span class="hljs-comment">// Avoid repainting if the child is already in place or the element does</span>
    <span class="hljs-comment">// not exist</span>
    <span class="hljs-keyword">var</span> el = <span class="hljs-keyword">this</span>.getEl();
    <span class="hljs-keyword">if</span> (el &amp;&amp; to &amp;&amp; !to.parentNode) {
      senna.append(el, to);
    }

    <span class="hljs-keyword">var</span> deferred = <span class="hljs-keyword">this</span>.transition(from, to);

    <span class="hljs-keyword">this</span>.activeChild = to;

    <span class="hljs-keyword">return</span> deferred.then(function() {
      <span class="hljs-keyword">if</span> (from &amp;&amp; from !== to) {
        senna.remove(from);
      }
    });
  };

  <span class="hljs-javadoc">/**
   * Removes screen content from a surface.
   * <span class="hljs-javadoctag">@param</span> {!String} screenId The screen id to remove.
   */</span>
  senna.Surface.prototype.remove = function(screenId) {
    <span class="hljs-keyword">var</span> child = <span class="hljs-keyword">this</span>.getChild(screenId);
    <span class="hljs-keyword">if</span> (child) {
      senna.remove(child);
    }
  };

  <span class="hljs-javadoc">/**
   * <span class="hljs-javadoctag">@return</span> {String}
   */</span>
  senna.Surface.prototype.toString = function() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.id;
  };

  <span class="hljs-javadoc">/**
   * Invokes the transition function specified on `transition` attribute.
   * <span class="hljs-javadoctag">@param</span> {?Element=} from
   * <span class="hljs-javadoctag">@param</span> {?Element=} to
   * <span class="hljs-javadoctag">@return</span> {?Promise=} This can return a promise, which will pause the
   *     navigation until it is resolved.
   */</span>
  senna.Surface.prototype.transition = function(from, to) {
    <span class="hljs-keyword">var</span> transitionFn = <span class="hljs-keyword">this</span>.transitionFn || senna.Surface.TRANSITION;
    <span class="hljs-keyword">return</span> senna.Promise.resolve(transitionFn.call(<span class="hljs-keyword">this</span>, from, to));
  };
}());
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="senna.App.html">App</a></li><li><a href="senna.Cacheable.html">Cacheable</a></li><li><a href="senna.DataAttributeHandler.html">DataAttributeHandler</a></li><li><a href="senna.EventEmitter.html">EventEmitter</a></li><li><a href="senna.HtmlScreen.html">HtmlScreen</a></li><li><a href="senna.RequestScreen.html">RequestScreen</a></li><li><a href="senna.Route.html">Route</a></li><li><a href="senna.Screen.html">Screen</a></li><li><a href="senna.Surface.html">Surface</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Thu Apr 30 2015 13:54:52 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
